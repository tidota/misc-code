# To generate a core dump file in Ubuntu

Ubuntu uses apport to generate a core dump file. I had a trouble to generate a core dump file and here is my personal note.

## Settings

Maybe, some of the steps are not necessary...


1. Make the size limit unlimited.
```
ulimit -c unlimited
```

2. Open the `limites.conf` file.
```
sudo vi /etc/security/limits.conf
```
Then add these two lines.
```
root             -       core            unlimited
*                -       core            unlimited
```

3. Create a setting file for apport
```
vi ~/.config/apport/settings
```
Add these lines.
```
[main]
unpackaged=true
```

4. Reboot (or log-off and log-in may be sufficient)

## Testing


1. To test, create a source file which definitely causes a segmentation fault.

```
cd ~
vi test.c
```

Write this bad code.
```
void foo()
{
    int* x = 0;
    *x = 0;
}

int main()
{
    foo();
    return 0;
}
```

2. Compile it with `-g` option.
```
gcc -g test.c
```

3. Run it, and it causes a segmentation fault

```
$ ./a.out
Segmentation fault (core dumped)

```

4. Locate the file generated by apport.

```
cd /var/crash
```

The file named like `_home_tidota_temp_a.out.1000.crash` should be found.

5. Unpack the file

```
mkdir temp
apport-unpack _home_tidota_temp_a.out.1000.crash temp
```
The unpacked files (including the core dump file) are stored in `temp`

6. Run gdb
```
cd ~
gdb a.out /var/crash/temp/CoreDump
```

Then, it shows the following information.
```
$ gdb a.out /var/crash/temp/CoreDump
GNU gdb (Ubuntu 12.0.90-0ubuntu1) 12.0.90
Copyright (C) 2022 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
Type "show copying" and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
Type "show configuration" for configuration details.
For bug reporting instructions, please see:
<https://www.gnu.org/software/gdb/bugs/>.
Find the GDB manual and other documentation resources online at:
    <http://www.gnu.org/software/gdb/documentation/>.

For help, type "help".
Type "apropos word" to search for commands related to "word"...
Reading symbols from a.out...
[New LWP 6434]
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
Core was generated by `./a.out'.
Program terminated with signal SIGSEGV, Segmentation fault.
#0  0x000055d5c6d4e13d in foo () at test.c:4
4	    *x = 0;
(gdb) 
```

